
<style>
  body {
    overflow: hidden;
  }
	iframe {
		width: 60%;
		height: 70%;
		border: #fff;
		margin-left: 20px;
    margin-top: 50px;
	}
	#note {
		margin-top: 15px;
    color: green;
    /*font-style: italic;*/
    font-size: 13px;
	}
  #or{
    text-align: center;
    margin-top: 20px;
    margin-bottom: 20px
  }
  #uploader{
    width: 90%;
    margin-top: 20px;
  }
  h5 {
    display:inline;
    color:purple;
    /*text-transform: uppercase;*/
  }
  .btn-warning {
    height: 18px;
    font-size: 11px;
    padding: 0 5px 0 5px;
    margin-left: 3px;
  }
</style>



<!-- ============= angular script ===============-->
<script type="text/javascript">

	// angular instantiate
	var myApp = angular.module('myApp', ['ngRoute','ngTouch','ngSanitize']);

	// controller
	myApp.controller('myController', function($scope, $http)
	{
		// set default values
		$scope.privacy = 'Public';

		// get folders from AWS S3
		$scope.dropvalues = ["default", "test1","test2"];

    // submit button clicked
		$scope.submit = function() {
			$scope.foldername = $scope.formvalue;
		};

    // dropdown listener
		$scope.$watch('dropvalue', function(){
			$scope.foldername = $scope.dropvalue;
		});

    // radio button listener
		$scope.$watch('privacy', function()
    {
      $http.get('/upload/'+$scope.privacy)
        .success(function(response) {

          $scope.notAuthenticated = response.data.notAuthenticated;
          $("#uploader").remove();

          if(response.data.notAuthenticated){
            $scope.errorMssg = '<h4>Oops! You must be logged in first';
            return;
          }

          $scope.errorMssg = null;
          $("#static").append('<div id="uploader"></div>');
          $("#uploader").plupload(response.data.plupload);
      })
        .error(function(response) {
          $scope.errorMssg =
          "<h4>Oops! Failed to load the uploader</h4><br/><p>Server Error: "+response+"</p>";
        });
		});

	});
</script>


<!-- ============= body ===============-->
<div style="margin-top:50px"></div>

<div class="content" ng-app="myApp" ng-controller="myController">
  <div class="container">

    <!-- LEFT -->
      <div class="layout layout-stack-sm layout-main-left" >
        <div class="col-sm-7 col-md-8 layout-main">
          <div class="portlet">
            <div class="portlet-body">

              <!-- Error messages -->
              <div ng-if="errorMssg" class="alert alert-danger fade in" role="alert" style="width:60%">
    		  	    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    		  	    <div ng-bind-html="errorMssg"></div>
                <p ng-if="notAuthenticated" style="margin-top:20px"><a href="/auth/google" role="button" class="btn btn-danger">Login</a></p>
  		        </div>

              <!-- mssg regarding destination folder -->
              <div ng-if="foldername" ng-model="mssg" class="alert alert-success" role="alert" ng-style="{width: 40 + foldername.length + '%'}">your files will be uploaded to <h5> {{foldername}}</h5> folder </div>

              <!-- Actual uploader gets attached here -->
              <div id="static">
                <div id="uploader"></div>
              </div>

            </div>
          </div>
        </div>

    <!-- RIGHT -->
      <div class="col-sm-5 col-md-4 layout-sidebar">

          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Upload to an existing folder</h3>
            </div>
            <div class="panel-body">
              <ul class="icons-list text-md">
                <select ng-model="dropvalue" ng-options="v as v for v in dropvalues" class="form-control" style="width:70%">
                <!-- angular inserts an empty value first. hide it like this -->
                 	<option style="display:none" value=""></option>
				        </select>
              </ul>
            </div>
          </div>


          <div id="or">
            <h4>OR</h4>
          </div>


          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Create a new folder</h3>
            </div>
            <div class="panel-body">
              <form role="form" class="form-inline" data-toggle="validator">
                  <div class="form-group">
                     <input type="text" pattern="^[A-Za-z][A-Za-z0-9\-\_]+" class="form-control" ng-model="formvalue" placeholder="enter new name">
                  </div>
                  <button type="submit" class="btn btn-info" ng-click="submit()">Submit</button>
                  <div class="help-block with-errors"></div>
              </form>
            <div id="note">Note: Use only letters, numbers, dash or underscore</div>
            </div>
          </div>


          <div class="panel panel-warning" style="margin-top:50px">
            <div class="panel-heading">
              <h3 class="panel-title">File Privacy</h3>
            </div>
            <div class="panel-body">
              <ul class="icons-list text-md">
                  <div class="radio">
            		<label>
            		<input type="radio" ng-model="privacy" value="Public" checked="checked">Public</label>
                  </div>
                  <div class="radio <% if(!user){ %> disabled <% } %>">
                    <label><input type="radio" value="Private" ng-model="privacy" <% if(!user){ %> disabled <% } %> >Private</label>
                    <a href="/auth/google" class="btn btn-warning" role="button">Login required</a>
                  </div>
                </ul>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>

