
<style>
  body {
    overflow: hidden;
  }
	iframe {
		width: 60%;
		height: 70%;
		border: #fff;
		margin-left: 20px;
    margin-top: 50px;
	}
	#note {
		margin-top: 15px;
    color: green;
    /*font-style: italic;*/
    font-size: 13px;
	}
  #or{
    text-align: center;
    margin-top: 20px;
    margin-bottom: 20px
  }
  #uploader{
    width: 90%;
    margin-top: 20px;
  }
  h5 {
    display:inline;
    color:purple;
    /*text-transform: uppercase;*/
  }
  .btn-warning {
    height: 18px;
    font-size: 11px;
    padding: 0 5px 0 5px;
  }
</style>



<!-- ============= angular script ===============-->
<script type="text/javascript">

	// angular instantiate
	var myApp = angular.module('myApp', ['ngRoute','ngTouch','ngMessages']);

  // controller
	myApp.controller('myController', function($scope)
	{
	    $scope.dropvalues = ["default", "test1","test2"];

	    // dropdown changed
	    $scope.change = function() {
	    	$scope.foldername = $scope.dropvalue;
      };

      // submit button
      $scope.submit = function(val) {
      	$scope.foldername = val;
      };
	});
</script>


<!-- ============= body ===============-->
<div style="margin-top:50px"></div>

<div class="content" ng-app="myApp" ng-controller="myController">
  <div class="container">

    <!-- LEFT -->
      <div class="layout layout-stack-sm layout-main-left" >
        <div class="col-sm-7 col-md-8 layout-main">
          <div class="portlet">
            <div class="portlet-body">

              <div ng-if="foldername" class="alert alert-success" role="alert" ng-style="{width: 40 + foldername.length + '%'}">ok, your files will be uploaded to <h5> {{foldername}}</h5> folder </div>

              <!-- Actual uploader gets attacehd here -->
              <div id="uploader">
                <p>Your browser doesn't support Flash or HTML5.<br>
                  You might be unable to upload files with this browser version</p>
              </div>

            </div>
          </div>
        </div>

    <!-- RIGHT -->
      <div class="col-sm-5 col-md-4 layout-sidebar">

          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Upload to an existing folder</h3>
            </div>
            <div class="panel-body">
              <ul class="icons-list text-md">
                <select ng-model="dropvalue" ng-options="v as v for v in dropvalues" ng-change="change()"
                 class="form-control" style="width:70%">
                 	<!-- angular inserts an empty value first. hide it like this -->
                 	<option style="display:none" value=""></option>
				</select>
              </ul>
            </div>
          </div>


          <div id="or">
            <h4>OR</h4>
          </div>


          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Create a new folder</h3>
            </div>
            <div class="panel-body">
              <form role="form" class="form-inline" data-toggle="validator">
                  <div class="form-group">
                     <input type="text" pattern="^[A-Za-z][A-Za-z0-9\-\_]+" class="form-control" ng-model="formvalue" placeholder="enter new name">
                  </div>
                  <button type="submit" class="btn btn-info" ng-click="submit(formvalue)">Submit</button>
                  <div class="help-block with-errors"></div>
              </form>
            <div id="note">Note: Use only letters, numbers, dash or underscore</div>
            </div>
          </div>


          <div class="panel panel-warning" style="margin-top:50px">
            <div class="panel-heading">
              <h3 class="panel-title">File Privacy</h3>
            </div>
            <div class="panel-body">
              <ul class="icons-list text-md">
                  <div class="radio">
                    <label>
                      <input type="radio" name="optionsRadios" id="optionsRadios1" value="public" checked="checked">
                       Public
                    </label>
                  </div>
                    <div class="radio  <% if(!user){ %> disabled <% } %>">
                    <label>
                      <input type="radio" name="optionsRadios" id="optionsRadios2" value="private"
                      <% if(!user){ %> disabled <% } %> >
                        Private <a href="/auth/google" class="btn btn-warning" role="button">Login required</a>
                      </label>
                  </div>
                </ul>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>



<!-- *************
    Javascript
  ***************** -->
<script>
$(function(){


  // input form
	// $('.form-inline').on('submit', function (e) {
	//   e.preventDefault();
	//   var newname = $("#newname").val()
	//   // console.log(newname);
	// });


  // dropdown
  // $('.form-control').on('change', function(){
  //   var selected = $(this).find("option:selected").val();
  //   // console.log(selected);
  // });


  // radio buttons
  $('input[type=radio][name=optionsRadios]').change(function() {
    if (this.value == 'private') {
      <% if (!user) { %>
        // $('#myModal').modal();
      <% } else { %>
        window.location = "/upload/private";
      <% } %>
    }
    else window.location = "/upload";
  });


  /*************
   Uploader
   ************/
  $("#uploader").plupload({
    runtimes : 'html5,flash',
    url : 'http://<%= s3Credentials.s3Bucket %>.s3.amazonaws.com/',

    multipart: true,
    multipart_params: {
      'key': '${filename}', // use filename as a key
      'Filename': '${filename}', // adding this to keep consistency across the runtimes
      'acl': 'public-read',
      'Content-Type': 'image/jpeg',
      'AWSAccessKeyId' : '<%= s3Credentials.s3Key %>',
      'policy': '<%= s3Credentials.s3PolicyBase64 %>',
      'signature': '<%= s3Credentials.s3Signature %>'
    },

    // Resize not recommended with S3, since it will force Flash runtime
    // into mode with NO PROGRESS INDICATION
    // resize : {width : 1024, height : 768, quality : 100},

    // optional, but better be specified directly
    file_data_name: 'file',

    filters : {
      max_file_size : '5mb',
      mime_types: [
        {title : "Image files", extensions : "jpg,jpeg,png,gif"}
      ]
    },

    // Flash settings
    flash_swf_url : '/js/Moxie.swf'

  });


});

</script>